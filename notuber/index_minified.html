<!DOCTYPE html><html><head> <title>Not Uber</title> <link rel="stylesheet" type="text/css" href="./style_minified.css"/> </head><body> <div id="map"></div><script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCAB2A0_ej5ZtoRuZl_k-YAOnBQArzd7WA&libraries=geometry,places&callback=findMyLocation&v=weekly" defer></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script> <script>let map; var myLat; var myLng; var distances=[]; var userNames=[]; var carLats=[]; var carLngs=[]; findMyLocation(); function findMyLocation(){if (navigator.geolocation){navigator.geolocation.getCurrentPosition(onCurrentPositionFound)}else{console.log("geolocation not supported")}}function onCurrentPositionFound(position){myLat=position.coords.latitude; myLng=position.coords.longitude; window.initMap=initMyMap(parseFloat(myLat), parseFloat(myLng));}function initMyMap(latitude, longitude){const map=new google.maps.Map(document.getElementById("map"),{center:{lat: latitude, lng: longitude}, zoom: 2.5,}); const myLocation=new google.maps.Marker({position:{lat: latitude, lng: longitude}, title: "Current Location", map,}); var request={location:{lat: latitude, lng: longitude}, radius: '804.672', type: ['restaurant']}; var service=new google.maps.places.PlacesService(map); service.nearbySearch(request, callback); function callback(results, status){if (status==google.maps.places.PlacesServiceStatus.OK){for (var i=0; i < results.length; i++){createMarker(results[i]);}}}function createMarker(place){if (!place.geometry || !place.geometry.location) return; const food="food.png"; var placesMarker=new google.maps.Marker({map, position: place.geometry.location, icon: food,}); placesMarker.title=place.name || "restaurant name could not be retrieved"; var placesMarkerInfowindow=new google.maps.InfoWindow(); google.maps.event.addListener(placesMarker, 'click', function (){placesMarkerInfowindow.setContent(this.title); placesMarkerInfowindow.open(map, this);});}var request; request=new XMLHttpRequest(); request.open("POST", "https://peaceful-citadel-39984.herokuapp.com/rides", true); request.setRequestHeader("Content-type", "application/x-www-form-urlencoded"); request.onreadystatechange=function (){if (request.readyState !==4 || request.status !==200) return; var data=request.responseText; console.log(data); var json_data=JSON.parse(data); console.log(json_data); for (numMarkers=0; numMarkers < json_data.length; numMarkers++){var carUsername=json_data[numMarkers]["username"]; var carLat=parseFloat(json_data[numMarkers]["lat"]); var carLng=parseFloat(json_data[numMarkers]["lng"]); const image="car.png"; var carMarker=new google.maps.Marker({position:{lat: carLat, lng: carLng}, map, icon: image,}); var myLatLng=new google.maps.LatLng(latitude, longitude); var carLatLng=new google.maps.LatLng(carLat, carLng); distances[numMarkers]=convertToMiles(google.maps.geometry.spherical.computeDistanceBetween(myLatLng, carLatLng)); userNames[numMarkers]=carUsername; carLats[numMarkers]=carLat; carLngs[numMarkers]=carLng; carMarker.title="Car " + carUsername + " is " + Math.round(distances[numMarkers]) + " miles away. It's coordinates are: " + carLat + "latitude and " + carLng + "longitude"; var carInfowindow=new google.maps.InfoWindow(); google.maps.event.addListener(carMarker, 'click', function (){carInfowindow.setContent(this.title); carInfowindow.open(map, this);});}var minDist=Math.min.apply(null, distances); var idx=distances.indexOf(minDist); var minDistCarName=userNames[idx]; var minCarLat=carLats[idx]; var minCarLng=carLngs[idx]; const path=[{lat: myLat, lng: myLng},{lat: minCarLat, lng: minCarLng}]; const line=new google.maps.Polyline({path: path, strokeColor: "#FF0000", strokeOpacity: 1.0, strokeWeight: 2,}); line.setMap(map); myLocation.title="Closest car is " + Math.round(minDist) + " miles away. Car username is " + minDistCarName; var infowindow=new google.maps.InfoWindow(); google.maps.event.addListener(myLocation, 'click', function (){infowindow.setContent(myLocation.title); infowindow.open(map, myLocation);});}
request.send("username=PT88yXTq&lat=" + latitude + "&lng=" + longitude);}function convertToMiles(meters){meterDist=meters; milesDist=meterDist / 1609.344; return milesDist;}</script></body></html>